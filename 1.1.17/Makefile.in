CC = @CC@ @ARCH@ @LTO@ @STD@ @MPI_DEFINE@
CFLAGS = -g -Wall -O3 @CPPFLAGS@ @GSL_CFLAGS@ @XML_CFLAGS@ @GLIB_CFLAGS@ \
	@GTHREAD_CFLAGS@
LDFLAGS = @LDFLAGS@ @LIBS@ @GSL_LIBS@ @XML_LIBS@ @GLIB_LIBS@ @GTHREAD_LIBS@

SRC = genetic/entity.c genetic/population.c genetic/reproduction.c \
	genetic/selection.c genetic/evolution.c genetic/genetic.c calibrator.c
OBJ = genetic/entity.o genetic/population.o genetic/reproduction.o \
	genetic/selection.o genetic/evolution.o genetic/genetic.o
DEP = Makefile
ES = locales/es/LC_MESSAGES/
FR = locales/fr/LC_MESSAGES/
T1 = tests/test1/
T2 = tests/test2/
T3 = tests/test3/
T4 = tests/test4/
TESTS = $(T1)simulator $(T1)evaluator $(T2)simulator $(T2)evaluator \
	$(T3)simulator $(T3)evaluator $(T4)simulator

all: calibrator calibrator_gui $(ES)calibrator_gui.mo $(FR)calibrator_gui.mo \
	$(TESTS)

genetic/entity.o: genetic/entity.c genetic/entity.h $(DEP)
	$(CC) $(CFLAGS) -c genetic/entity.c -o genetic/entity.o

genetic/population.o: genetic/population.c genetic/population.h \
	genetic/entity.h genetic/bits.h $(DEP)
	$(CC) $(CFLAGS) -c genetic/population.c -o genetic/population.o

genetic/reproduction.o: genetic/reproduction.c genetic/reproduction.h \
	genetic/entity.h genetic/bits.h $(DEP)
	$(CC) $(CFLAGS) -c genetic/reproduction.c -o genetic/reproduction.o

genetic/selection.o: genetic/selection.c genetic/selection.h \
	genetic/population.h genetic/entity.h $(DEP)
	$(CC) $(CFLAGS) -c genetic/selection.c -o genetic/selection.o

genetic/evolution.o: genetic/evolution.c genetic/evolution.h \
	genetic/selection.h genetic/reproduction.h genetic/mutation.h \
	genetic/population.h genetic/entity.h genetic/sort.h genetic/bits.h $(DEP)
	$(CC) $(CFLAGS) -c genetic/evolution.c -o genetic/evolution.o

genetic/genetic.o: genetic/genetic.c genetic/genetic.h genetic/evolution.h \
	genetic/selection.h genetic/reproduction.h genetic/population.h \
	genetic/entity.h genetic/bits.h $(DEP)
	$(CC) $(CFLAGS) -c genetic/genetic.c -o genetic/genetic.o

calibrator: calibrator.c calibrator.h $(OBJ) config.h
	$(CC) $(CFLAGS) calibrator.c $(OBJ) $(LDFLAGS) -o calibrator

calibrator_gui: calibrator.c interface.h calibrator.h $(OBJ) config.h
	$(CC) $(CFLAGS) @GTK_CFLAGS@ calibrator.c $(LDFLAGS) @GTK_LIBS@ \
		-o calibrator_gui -DHAVE_GTK=1

locales/calibrator_gui.pot: calibrator_gui
	xgettext -d calibrator_gui -o locales/calibrator_gui.pot --from-code=UTF-8 \
		$(SRC)

$(ES)calibrator_gui.po: locales/calibrator_gui.pot
	test -d $(ES) || mkdir -p $(ES)
	test -f $(ES)calibrator_gui.po || msginit -l es -o $(ES)calibrator_gui.po \
		-i locales/calibrator_gui.pot --no-translator
	msgmerge -U $(ES)calibrator_gui.po locales/calibrator_gui.pot
	vim -p $(ES)calibrator_gui.po
	touch $(ES)calibrator_gui.po

$(ES)calibrator_gui.mo: $(ES)calibrator_gui.po locales/calibrator_gui.pot
	msgfmt -c -v -o $(ES)calibrator_gui.mo $(ES)calibrator_gui.po

$(FR)calibrator_gui.po: locales/calibrator_gui.pot
	test -d $(FR) || mkdir -p $(FR)
	test -f $(FR)calibrator_gui.po || msginit -l fr -o $(FR)calibrator_gui.po \
		-i locales/calibrator_gui.pot --no-translator
	msgmerge -U $(FR)calibrator_gui.po locales/calibrator_gui.pot
	vim -p $(FR)calibrator_gui.po
	touch $(FR)calibrator_gui.po

$(FR)calibrator_gui.mo: $(FR)calibrator_gui.po locales/calibrator_gui.pot
	msgfmt -c -v -o $(FR)calibrator_gui.mo $(FR)calibrator_gui.po

$(T1)simulator: $(T1)simulator.c $(T1)Makefile
	cd $(T1); make

$(T1)evaluator: $(T1)evaluator.c $(T1)Makefile
	cd $(T1); make

$(T2)simulator: $(T2)simulator.c $(T2)Makefile
	cd $(T2); make

$(T2)evaluator: $(T2)evaluator.c $(T2)Makefile
	cd $(T2); make

$(T3)simulator: $(T3)simulator.c $(T3)Makefile
	cd $(T3); make

$(T3)evaluator: $(T3)evaluator.c $(T3)Makefile
	cd $(T3); make

$(T4)simulator: $(T4)simulator.c $(T4)Makefile
	cd $(T4); make

doc: calibrator.c config.h README.md $(DEP)
	doxygen
	cd latex; make
